\begin{tikzpicture}[
    node distance=1.2cm and 1.2cm,
    font=\sffamily\small,
    >=Stealth,
    % Define specific colors for clarity
    colIngest/.style={fill=blue!10, draw=blue!40, thick},
    colProcess/.style={fill=yellow!10, draw=orange!40, thick},
    colStore/.style={fill=green!10, draw=green!40, thick},
    colRetrieval/.style={fill=purple!10, draw=purple!40, thick},
    % Define shapes
    block/.style={rectangle, rounded corners, align=center, minimum width=2.8cm, minimum height=1cm, inner sep=6pt},
    pill/.style={rectangle, rounded corners=0.5cm, align=center, fill=gray!10, draw=gray, thin, font=\footnotesize},
    container/.style={draw, dashed, inner sep=0.6cm, rounded corners, fill=gray!5, label={[anchor=north west, text=gray!70, font=\bfseries\footnotesize, yshift=-0.2cm]north west:#1}}
]

    % --- Data Ingestion Phase ---
    \node[block, colIngest] (sources) {
        \textbf{Data Sources}\\
        \faGit*\ \ Git \quad \faFilePdf[regular]\ \ Docs \quad \faBug\ \ Jira
    };

    % --- Processing Phase ---
    \node[block, colProcess, below=of sources] (chunks) {
        \textbf{Chunking & Splitting}\\
        \faCut\ \ Structure-Aware
    };
    
    \node[block, colProcess, below=of chunks] (embed) {
        \textbf{Embedding & Extraction}\\
        \faBrain\ \ Model + RE
    };

    % --- Storage Phase ---
    % Vector Store (Left)
    \node[block, colStore, below left=1.5cm and 0.2cm of embed] (vec_store) {
        \textbf{Vector Store}\\
        \faDatabase\ \ Embeddings
    };
    
    % Knowledge Graph (Right)
    \node[block, colStore, below right=1.5cm and 0.2cm of embed] (graph_store) {
        \textbf{Knowledge Graph}\\
        \faProjectDiagram\ \ Entities/Relations
    };

    % --- Retrieval Phase (The "RAG" Loop) ---
    % Position retrieval layer relative to vector store to ensure clearance
    \node[block, colRetrieval, below=2cm of vec_store] (retrieval) at ($(vec_store)!0.5!(graph_store) + (0,-2.5cm)$) {
        \textbf{Hybrid Retrieval}\\
        \faSearch\ \ Vector + Graph
    };

    \node[block, colRetrieval, below=of retrieval] (llm) {
        \textbf{LLM Generation}\\
        \faRobot\ \ Response
    };

    \node[pill, left=of retrieval] (query) {\faUser\ \ User Query};

    % --- Connections ---
    \draw[->, thick] (sources) -- (chunks);
    \draw[->, thick] (chunks) -- (embed);
    
    % Split to stores
    \draw[->, thick] (embed) -- node[left, font=\footnotesize, pos=0.4] {Vectors} (vec_store);
    \draw[->, thick] (embed) -- node[right, font=\footnotesize, pos=0.4] {Triples} (graph_store);
    
    % Retrieval flows
    \draw[->, thick] (query) -- (retrieval);
    \draw[<->, dashed, thick] (retrieval) -- (vec_store);
    \draw[<->, dashed, thick] (retrieval) -- (graph_store);
    \draw[->, thick] (retrieval) -- node[right, font=\footnotesize] {Context} (llm);

    % --- Grouping Containers (Background) ---
    \begin{scope}[on background layer]
        \node[container={Ingestion Pipeline}, fit=(sources) (chunks) (embed)] (box_ingest) {};
        \node[container={Knowledge Base}, fit=(vec_store) (graph_store)] (box_storage) {};
        \node[container={Inference}, fit=(query) (retrieval) (llm)] (box_inference) {};
    \end{scope}

\end{tikzpicture}